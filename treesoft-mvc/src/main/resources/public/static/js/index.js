var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.findInternal=function(a,b,c){a instanceof String&&(a=String(a));for(var e=a.length,f=0;f<e;f++){var g=a[f];if(b.call(c,g,f,a))return{i:f,v:g}}return{i:-1,v:void 0}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){a!=Array.prototype&&a!=Object.prototype&&(a[b]=c.value)};
$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);$jscomp.polyfill=function(a,b,c,e){if(b){c=$jscomp.global;a=a.split(".");for(e=0;e<a.length-1;e++){var f=a[e];f in c||(c[f]={});c=c[f]}a=a[a.length-1];e=c[a];b=b(e);b!=e&&null!=b&&$jscomp.defineProperty(c,a,{configurable:!0,writable:!0,value:b})}};
$jscomp.polyfill("Array.prototype.find",function(a){return a?a:function(a,c){return $jscomp.findInternal(this,a,c).v}},"es6","es3");var editor,dg,d,pwd,config,tableName,type,rowtype,colums="",searchBG,databaseName,databaseType,exportLimit,isRead,add,primary_key,saveSearch,selectRowCount=0,heightStr=300,sqlArray=[],columnsTemp=[],index=0,messTemp="",databaseConfigId,obj,willChangeRow=[],sql_autocomplete_in_progress=!1,sql_autocomplete=!1,newQueryTabNum=1,currentDbName,firstTimeLoginConfigDialog,executeAjax;
$(document).ready(function(){editor=CodeMirror.fromTextArea(document.getElementById("sqltextarea"),{lineNumbers:!0,matchBrackets:!0,hintOptions:{completeSingle:!1,completeOnSingleClick:!0},indentUnit:4,mode:"text/x-mysql",lineWrapping:!0,theme:"eclipse",autofocus:!0,extraKeys:{ctrl:"autocomplete",F7:function(){clearSQL()},F8:function(){run()}}});editor.on("inputRead",codemirrorAutocompleteOnInputRead);editor.refresh();editor.focus();$(editor.getWrapperElement()).bind("keydown",catchKeypressesFromSqlTextboxes);
var a=$.cookie("editStyle");a?(editor.setOption("theme",a),executeMessage.setOption("theme",a),$("#codeThemeSelector").val(a)):editor.setOption("theme","eclipse");1==$("#firstIndexPage").val()&&openMonitorGlobalPage()});function imgerror(a){a.src=baseUrl+"/static/images/logo.png";a.onerror=null}$(function(){initSqlStudyTree();init3()});
function init3(){$.ajax({type:"get",url:baseUrl+"/system/permission/i/allDatabaseList",success:function(a){$("#databaseSelect").empty();$.each(a,function(b,c){$("#databaseSelect").append("<option value='"+a[b].id+"' title='"+a[b].ip+":"+a[b].port+"'   >\u3010"+a[b].databaseType+"\u3011"+a[b].name+" </option>")});databaseName=a[0].databaseName;databaseType=a[0].databaseType;exportLimit=a[0].exportLimit;isRead=a[0].isRead;$("#currentDbTitle").html(databaseName);currentDbName=databaseName;"true"==$("#isFirstTimeLogin").val()?
firstLoginConfig():initDataBase()}})}$("#databaseSelect").change(function(){databaseConfigId=$("#databaseSelect").val();initDataBase();$("#executeMessage").val("");executeMessage.setValue("");sql_autocomplete=!1;getDataBaseConfig();$("#mainTabs").tabs("select",0)});
function getDataBaseConfig(){$.ajax({type:"get",url:baseUrl+"/system/permission/i/getDataBaseConfig/"+databaseConfigId,success:function(a){databaseName=a.databaseName;databaseType=a.databaseType;exportLimit=a.exportLimit;isRead=a.isRead;$("#currentDbTitle").html(databaseName);currentDbName=databaseName}})}
function initDataBase(){databaseConfigId=$("#databaseSelect").val();dg=$("#pid").treegrid({method:"POST",url:baseUrl+"/system/permission/i/databaseList/"+databaseConfigId,fit:!0,fitColumns:!0,border:!1,idField:"id",treeField:"name",parentField:"pid",iconCls:"icon",animate:!0,rownumbers:!1,singleSelect:!0,striped:!0,columns:[[{field:"name",title:"&nbsp;&nbsp;\u8be6\u60c5",width:210}]],enableHeaderClickMenu:!1,enableHeaderContextMenu:!1,enableRowContextMenu:!1,onContextMenu:onContextMenu2,dataPlain:!1,
onLoadSuccess:function(a,b){0==b.length&&($.messager.show({title:"\u63d0\u793a",msg:"\u6570\u636e\u5e93\u67e5\u8be2\u5931\u8d25\uff0c\u8bf7\u68c0\u67e5\u53c2\u6570\u914d\u7f6e\u4fe1\u606f",position:"center",icon:"warning",timeout:6E3}),$.easyui.loaded())},onClickRow:function(a){tableName=a.name;type=a.type;var b=$("#mainTabs").tabs("getSelected");if(0==$("#mainTabs").tabs("getTabIndex",b)){columnsTemp.length=0;$("#searchHistoryId").val("");$("#searchHistoryName").val("");databaseName=$("#pid").treegrid("getRoot",
a.id).name;"db"==type&&(databaseName=a.name,$("#currentDbTitle").html(databaseName),currentDbName=databaseName);"direct"==type&&(databaseName=$("#pid").treegrid("getParent",a.id).name,$("#currentDbTitle").html(databaseName),currentDbName=databaseName);if("table"==type){b=$("#pid").treegrid("getParent",a.id);b=$("#pid").treegrid("getParent",b.id);selectRowCount=0;databaseName=b.name;$("#currentDbTitle").html(databaseName);currentDbName=databaseName;$("#currentTableName").val(tableName);var c=$.trim(editor.getValue());
b=selectTableWhileClick(databaseName,tableName);editor.setValue(b+"; \n"+c)}"view"==type&&(selectRowCount=0,c=$.trim(editor.getValue()),b=selectTableWhileClick(databaseName,tableName),editor.setValue(b+"; \n"+c));"esIndex"==type&&(selectRowCount=0,c=$.trim(editor.getValue()),b=selectTableWhileClick(databaseName,tableName),editor.setValue(b+"; \n"+c))}else{if("db"==type||"direct"==type)return;if((b=$("#mainTabs").tabs("getSelected"))&&0<b.find("iframe").length&&(c=b.find("iframe")[0].contentWindow,
"undefined"!=typeof c.newQueryEditor)){var e=c.newQueryEditor.getValue();b=selectTableWhileClick(databaseName,tableName);c.newQueryEditor.setValue(b+";\n"+e+"\n")}}"shard"==type&&clickNoSQLDbName(a.name)}});editor.focus()}
function designTable(){1==isRead?$.messager.show({title:"\u63d0\u793a",msg:"\u5f53\u524d\u6570\u636e\u5e93\u53ea\u8bfb\uff0c\u9650\u5236\u8be5\u64cd\u4f5c.",position:"top",icon:"warning"}):window.mainpage.mainTabs.addModule("\u8bbe\u8ba1"+tableName+" @"+databaseName,baseUrl+"/system/permission/i/designTable/"+tableName+"/"+databaseName+"/"+databaseConfigId,"icon-hamburg-config")}
function addNewTable(){1==isRead?$.messager.show({title:"\u63d0\u793a",msg:"\u5f53\u524d\u6570\u636e\u5e93\u53ea\u8bfb\uff0c\u9650\u5236\u8be5\u64cd\u4f5c.",position:"top",icon:"warning"}):window.mainpage.mainTabs.addModule("\u65b0\u589e\u8868",baseUrl+"/system/permission/i/addNewTable/"+databaseName+"/"+databaseConfigId,"icon-hamburg-config")}
function exportTable(){1==isRead?$.messager.show({title:"\u63d0\u793a",msg:"\u5f53\u524d\u6570\u636e\u5e93\u53ea\u8bfb\uff0c\u9650\u5236\u8be5\u64cd\u4f5c.",position:"top",icon:"warning"}):($.easyui.loading({msg:"\u5907\u4efd\u4e2d\uff0c\u8bf7\u7a0d\u7b49\uff01"}),$.ajax({type:"POST",contentType:"application/json;charset=utf-8",url:baseUrl+"/system/permission/i/exportTable/"+databaseConfigId,data:JSON.stringify({databaseName:databaseName,tableName:tableName}),datatype:"json",success:function(a){var b=
a.status;$.easyui.loaded();"success"==b?($.messager.show({title:"\u63d0\u793a",msg:a.mess,position:"bottomRight"}),window.mainpage.mainTabs.addModule("\u5907\u4efd",baseUrl+"/system/permission/i/backupDatabase/"+databaseName+"/"+databaseConfigId,"icon-berlin-calendar")):$.messager.show({title:"\u63d0\u793a",msg:a.mess,position:"bottomRight"})}}))}
function copyTable(){1==isRead?$.messager.show({title:"\u63d0\u793a",msg:"\u5f53\u524d\u6570\u636e\u5e93\u53ea\u8bfb\uff0c\u9650\u5236\u8be5\u64cd\u4f5c.",position:"top",icon:"warning"}):($.easyui.loading({msg:"\u590d\u5236\u4e2d\uff0c\u8bf7\u7a0d\u7b49\uff01"}),$.ajax({type:"POST",contentType:"application/json;charset=utf-8",url:baseUrl+"/system/permission/i/copyTable/"+databaseConfigId,data:JSON.stringify({databaseName:databaseName,tableName:tableName}),datatype:"json",success:function(a){var b=
a.status;$.easyui.loaded();"success"==b?($.messager.show({title:"\u63d0\u793a",msg:a.mess,position:"bottomRight"}),$("#pid").treegrid("reload")):$.messager.show({title:"\u63d0\u793a",msg:a.mess,position:"bottomRight",timeout:2E3,icon:"warning"})}}))}
function renameTable(){1==isRead?$.messager.show({title:"\u63d0\u793a",msg:"\u5f53\u524d\u6570\u636e\u5e93\u53ea\u8bfb\uff0c\u9650\u5236\u8be5\u64cd\u4f5c.",position:"top",icon:"warning"}):$.easyui.messager.prompt("\u63d0\u793a","\u65b0\u8868\u540d :",function(a){a&&($.easyui.loading({msg:"\u64cd\u4f5c\u4e2d\uff0c\u8bf7\u7a0d\u7b49\uff01"}),$.ajax({type:"POST",contentType:"application/json;charset=utf-8",url:baseUrl+"/system/permission/i/renameTable/"+databaseConfigId,data:JSON.stringify({databaseName:databaseName,
tableName:tableName,newTableName:a}),datatype:"json",success:function(a){var b=a.status;$.easyui.loaded();"success"==b?($.messager.show({title:"\u63d0\u793a",msg:a.mess,position:"bottomRight"}),$("#pid").treegrid("reload")):$.messager.show({title:"\u63d0\u793a",msg:a.mess,position:"bottomRight",timeout:2E3,icon:"warning"})}}))})}
function dropTable(){1==isRead?$.messager.show({title:"\u63d0\u793a",msg:"\u5f53\u524d\u6570\u636e\u5e93\u53ea\u8bfb\uff0c\u9650\u5236\u8be5\u64cd\u4f5c.",position:"top",icon:"warning"}):$.easyui.messager.confirm("\u64cd\u4f5c\u63d0\u9192","\u60a8\u786e\u5b9a\u5220\u9664 "+tableName+" \u5417\uff1f",function(a){a&&$.ajax({type:"POST",contentType:"application/json;charset=utf-8",url:baseUrl+"/system/permission/i/dropTable/"+databaseConfigId,data:JSON.stringify({databaseName:databaseName,tableName:tableName}),
datatype:"json",success:function(a){$("#pid").treegrid("reload");$.messager.show({title:"\u63d0\u793a",msg:a.mess,position:"bottomRight"})}})})}
function dropDatabase(){1==isRead?$.messager.show({title:"\u63d0\u793a",msg:"\u5f53\u524d\u6570\u636e\u5e93\u53ea\u8bfb\uff0c\u9650\u5236\u8be5\u64cd\u4f5c.",position:"top",icon:"warning"}):$.easyui.messager.confirm("\u64cd\u4f5c\u63d0\u9192","\u60a8\u786e\u5b9a\u8981\u5220\u9664\u6570\u636e\u5e93 "+databaseName+" \u5417\uff1f",function(a){a&&$.ajax({type:"POST",contentType:"application/json;charset=utf-8",url:baseUrl+"/system/permission/i/dropDatabase/"+databaseConfigId,data:JSON.stringify({databaseName:databaseName}),
datatype:"json",success:function(a){$("#pid").treegrid("reload");$.messager.show({title:"\u63d0\u793a",msg:a.mess,position:"bottomRight"})}})})}
function clearTable(){1==isRead?$.messager.show({title:"\u63d0\u793a",msg:"\u5f53\u524d\u6570\u636e\u5e93\u53ea\u8bfb\uff0c\u9650\u5236\u8be5\u64cd\u4f5c.",position:"top",icon:"warning"}):$.easyui.messager.confirm("\u64cd\u4f5c\u63d0\u9192","\u60a8\u786e\u5b9a\u8981\u6e05\u7a7a\u8868 "+tableName+"\u5417\uff1f",function(a){a&&$.ajax({type:"POST",contentType:"application/json;charset=utf-8",url:baseUrl+"/system/permission/i/clearTable/"+databaseConfigId,data:JSON.stringify({databaseName:databaseName,
tableName:tableName}),datatype:"json",success:function(a){$.messager.show({title:"\u63d0\u793a",msg:a.mess,position:"bottomRight"})}})})}
function createTableSQL(){$.ajax({type:"get",url:baseUrl+"/system/permission/i/createTableSQL/"+tableName+"/"+databaseName+"/"+databaseConfigId,success:function(a){if("success"==a.status){var b;if((b=parent.$("#mainTabs").tabs("getSelected"))&&0<b.find("iframe").length)if(b=b.find("iframe")[0].contentWindow,"undefined"!=typeof b.newQueryEditor){var c=b.newQueryEditor.getValue();b.newQueryEditor.setValue(c+"\n"+a.createTableSQLItem+"\n")}else $("#mainTabs").tabs("select",0),b=editor.getValue(),editor.setValue(a.createTableSQLItem+
";\n"+b+"\n");else $("#mainTabs").tabs("select",0),b=editor.getValue(),editor.setValue(a.createTableSQLItem+";\n"+b)}else $.messager.show({title:"\u63d0\u793a",msg:a.mess,position:"bottomRight"})}})}
function makeTableSQLTemp(){$.ajax({type:"get",url:baseUrl+"/system/permission/i/makeTableSQLTemp/"+tableName+"/"+databaseName+"/"+databaseConfigId,success:function(a){if("success"==a.status){var b;if((b=parent.$("#mainTabs").tabs("getSelected"))&&0<b.find("iframe").length)if(b=b.find("iframe")[0].contentWindow,"undefined"!=typeof b.newQueryEditor){var c=b.newQueryEditor.getValue();b.newQueryEditor.setValue(c+"\n"+a.makeTableSQLItem+"\n")}else $("#mainTabs").tabs("select",0),b=editor.getValue(),editor.setValue(a.makeTableSQLItem+
"\n"+b);else $("#mainTabs").tabs("select",0),b=editor.getValue(),editor.setValue(a.makeTableSQLItem+"\n"+b)}else $.messager.show({title:"\u63d0\u793a",msg:a.mess,position:"bottomRight",timeout:2E3,icon:"warning"})}})}function tableMess(){window.mainpage.mainTabs.addModule(tableName+"\u4fe1\u606f",baseUrl+"/system/permission/i/showTableMess/"+tableName+"/"+databaseName+"/"+databaseConfigId,"icon-berlin-calendar")}
function onContextMenu2(a,b){a.preventDefault();$(this).treegrid("select",b.id);var c=b.name,e=b.type;"db"==e&&(databaseName=b.name,$("#databaseMenu").menu("show",{left:a.pageX,top:a.pageY}));"direct"==e&&(databaseName=$("#pid").treegrid("getParent",b.id).name);if("table"==e){$("#tableMenu").menu("show",{left:a.pageX,top:a.pageY});tableName=c;var f=$("#pid").treegrid("getParent",b.id);f=$("#pid").treegrid("getParent",f.id);databaseName=f.name}"view"==e&&($("#viewMenu").menu("show",{left:a.pageX,top:a.pageY}),
tableName=c,f=$("#pid").treegrid("getParent",b.id),f=$("#pid").treegrid("getParent",f.id),databaseName=f.name);"function"==e&&($("#functionMenu").menu("show",{left:a.pageX,top:a.pageY}),tableName=c,f=$("#pid").treegrid("getParent",b.id),f=$("#pid").treegrid("getParent",f.id),databaseName=f.name);"procedure"==e&&($("#procedureMenu").menu("show",{left:a.pageX,top:a.pageY}),tableName=c,f=$("#pid").treegrid("getParent",b.id),f=$("#pid").treegrid("getParent",f.id),databaseName=f.name);"package"==e&&($("#packageMenu").menu("show",
{left:a.pageX,top:a.pageY}),tableName=c,f=$("#pid").treegrid("getParent",b.id),f=$("#pid").treegrid("getParent",f.id),databaseName=f.name);"packageBody"==e&&($("#packageBodyMenu").menu("show",{left:a.pageX,top:a.pageY}),tableName=c,f=$("#pid").treegrid("getParent",b.id),f=$("#pid").treegrid("getParent",f.id),databaseName=f.name);"esIndex"==e&&($("#esIndexMenu").menu("show",{left:a.pageX,top:a.pageY}),tableName=c,f=$("#pid").treegrid("getParent",b.id),f=$("#pid").treegrid("getParent",f.id),databaseName=
f.name)}
function initSqlStudyTree(){$("#sqlStudyList").treegrid({method:"GET",url:baseUrl+"/system/permission/i/selectSqlStudy",fit:!0,fitColumns:!0,border:!1,idField:"id",treeField:"title",parentField:"pid",iconCls:"icon",animate:!0,rownumbers:!1,singleSelect:!0,striped:!0,columns:[[{field:"title",title:"&nbsp;&nbsp;\u8be6\u60c5",width:210}]],enableHeaderClickMenu:!1,enableHeaderContextMenu:!1,enableRowContextMenu:!0,dataPlain:!1,onClickRow:function(a){var b;if((b=parent.$("#mainTabs").tabs("getSelected"))&&0<
b.find("iframe").length)if(b=b.find("iframe")[0].contentWindow,"undefined"!=typeof b.newQueryEditor){var c=b.newQueryEditor.getValue();b.newQueryEditor.setValue(a.content+";\n"+c)}else $("#mainTabs").tabs("select",0),b=editor.getValue(),editor.setValue(a.content+";\n"+b),$("#searchHistoryId").val(""),$("#searchHistoryName").val("");else $("#mainTabs").tabs("select",0),b=editor.getValue(),editor.setValue(a.content+";\n"+b),$("#searchHistoryId").val(""),$("#searchHistoryName").val("")}})}
function selectTableWhileClick(a,b){messTemp="";return"ShenTong"==databaseType?"SELECT   *   FROM  "+a+"."+b:"DM7"==databaseType?"SELECT   *   FROM  "+a+"."+b:"MongoDB"==databaseType?"db."+b+".find({})":"SELECT   *   FROM  "+b}
function clickTable(a){1==isRead?$.messager.show({title:"\u63d0\u793a",msg:"\u5f53\u524d\u6570\u636e\u5e93\u53ea\u8bfb\uff0c\u9650\u5236\u8be5\u64cd\u4f5c.",position:"top",icon:"warning"}):window.mainpage.mainTabs.addModule(a+" @"+databaseName,baseUrl+"/system/permission/i/showTableData/"+a+"/"+databaseName+"/"+databaseConfigId+"/table","icon-berlin-calendar")}
function openView(a){window.mainpage.mainTabs.addModule(a+" @"+databaseName,baseUrl+"/system/permission/i/showTableData/"+a+"/"+databaseName+"/"+databaseConfigId+"/view","icon-berlin-calendar")}function jsonFormat(){window.mainpage.mainTabs.addModule("Json\u683c\u5f0f\u5316",baseUrl+"/tools/jsonFormat","icon-hamburg-sitemap")}function log(){window.mainpage.mainTabs.addModule("\u64cd\u4f5c\u65e5\u5fd7",baseUrl+"/system/log/log","icon-hamburg-sitemap")}
function backupDatabase(){1==isRead?$.messager.show({title:"\u63d0\u793a",msg:"\u5f53\u524d\u6570\u636e\u5e93\u53ea\u8bfb\uff0c\u9650\u5236\u8be5\u64cd\u4f5c.",position:"top",icon:"warning"}):(window.mainpage.mainTabs.addModule("\u5907\u4efd",baseUrl+"/system/permission/i/backupDatabase/"+databaseName+"/"+databaseConfigId,"icon-hamburg-database"),$.messager.show({title:"\u63d0\u793a",msg:"\u8bf7\u70b9\u51fb\u3010\u6570\u636e\u5907\u4efd\u3011\u6309\u94ae\uff0c<br>\u8fdb\u884c\u6570\u636e\u5e93\u7684\u5907\u4efd\uff01",
timeout:2E3}))}function ShowConfigPage(){window.mainpage.mainTabs.addModule("\u6570\u636e\u5e93\u914d\u7f6e",baseUrl+"/system/config/configList","icon-hamburg-config")}function monitor(){window.mainpage.mainTabs.addModule("\u72b6\u6001\u76d1\u63a7",baseUrl+"/system/permission/i/monitor/"+databaseName+"/"+databaseConfigId,"icon-hamburg-equalizer")}function dataSynchronize(){window.mainpage.mainTabs.addModule("\u6570\u636e\u540c\u6b65",baseUrl+"/dataSynchronize/index","icon-hamburg-exchange")}
function task(){window.mainpage.mainTabs.addModule("\u5b9a\u65f6\u4efb\u52a1",baseUrl+"/system/task/i/task/","icon-hamburg-future")}function collect(){window.mainpage.mainTabs.addModule("\u6570\u636eAPI",baseUrl+"/collect/collectListPage/","icon-hamburg-exchange")}function sqlDistribute(){window.mainpage.mainTabs.addModule("SQL\u5206\u53d1",baseUrl+"/system/sqlDistribute/listPage/","icon-hamburg-exchange")}
function orderApply(){window.mainpage.mainTabs.addModule("\u5de5\u5355\u7533\u8bf7",baseUrl+"/order/orderList/","icon-hamburg-attibutes")}function orderAudit(){window.mainpage.mainTabs.addModule("\u5de5\u5355\u5ba1\u6838",baseUrl+"/order/orderAuditList/","icon-hamburg-archives")}function newQuery(){window.mainpage.mainTabs.addModule("\u65b0\u5efa\u67e5\u8be2"+newQueryTabNum+" @"+databaseName,baseUrl+"/newQuery/index/"+databaseName+"/"+databaseConfigId,"icon-standard-magnifier");newQueryTabNum++}
function showSQL(a,b){a="select * from "+a+";";b=editor.getValue();$("#sqltextarea").val(b+"\n"+a);editor.setValue(b+"\n"+a);$("#executeMessage").html("");executeMessage.setValue("")}
function showViewSQL(a,b){$("#mainTabs").tabs("select",0);$.ajax({type:"POST",contentType:"application/json;charset=utf-8",url:baseUrl+"/system/permission/i/getViewSql/"+databaseConfigId,data:JSON.stringify({databaseName:a,tableName:b}),datatype:"json",success:function(a){if("success"==a.status){$("#mainTabs").tabs("select",0);var b=editor.getValue();editor.setValue(a.viewSql+";\n"+b)}else $.messager.show({title:"\u63d0\u793a",msg:a.mess,position:"bottomRight",timeout:2E3,icon:"warning"})}})}
function showFunctionSQL(a,b){$("#mainTabs").tabs("select",0);$.ajax({type:"POST",contentType:"application/json;charset=utf-8",url:baseUrl+"/system/permission/i/getFunctionSql/"+databaseConfigId,data:JSON.stringify({databaseName:a,tableName:b}),datatype:"json",success:function(a){if("success"==a.status){$("#mainTabs").tabs("select",0);var b=editor.getValue();editor.setValue(a.viewSql+"\n"+b+"\n")}else $.messager.show({title:"\u63d0\u793a",msg:a.mess,position:"bottomRight",timeout:2E3,icon:"warning"})}})}
function showProcedureSQL(a,b){$("#mainTabs").tabs("select",0);$.ajax({type:"POST",contentType:"application/json;charset=utf-8",url:baseUrl+"/system/permission/i/getProcedureSql/"+databaseConfigId,data:JSON.stringify({databaseName:a,tableName:b}),datatype:"json",success:function(a){if("success"==a.status){$("#mainTabs").tabs("select",0);var b=editor.getValue();editor.setValue(a.viewSql+"\n"+b+"\n")}else $.messager.show({title:"\u63d0\u793a",msg:a.mess,position:"bottomRight",timeout:2E3,icon:"warning"})}})}
function showPackageSQL(a,b){$("#mainTabs").tabs("select",0);$.ajax({type:"POST",contentType:"application/json;charset=utf-8",url:baseUrl+"/system/permission/i/getPackageSql/"+databaseConfigId,data:JSON.stringify({databaseName:a,tableName:b}),datatype:"json",success:function(a){if("success"==a.status){$("#mainTabs").tabs("select",0);var b=editor.getValue();editor.setValue(a.viewSql+"\n"+b+"\n")}else $.messager.show({title:"\u63d0\u793a",msg:a.mess,position:"bottomRight",timeout:2E3,icon:"warning"})}})}
function showPackageBodySQL(a,b){$("#mainTabs").tabs("select",0);$.ajax({type:"POST",contentType:"application/json;charset=utf-8",url:baseUrl+"/system/permission/i/getPackageBodySql/"+databaseConfigId,data:JSON.stringify({databaseName:a,tableName:b}),datatype:"json",success:function(a){if("success"==a.status){$("#mainTabs").tabs("select",0);var b=editor.getValue();editor.setValue(a.viewSql+"\n"+b+"\n")}else $.messager.show({title:"\u63d0\u793a",msg:a.mess,position:"bottomRight",timeout:2E3,icon:"warning"})}})}
var dangerSQL=CodeMirror.fromTextArea(document.getElementById("dangerSQL"),{mode:"text/x-mysql",theme:"eclipse",lineNumbers:!0,lineWrapping:!0,readOnly:!0});dangerSQL.setSize("480px","250px");
function run(){var a=$.trim(editor.getValue()),b=editor.getSelection();""!=b&&(a=b);sqlArray=[];var c=[];messTemp="";""==a||null==a?$.messager.show({title:"\u63d0\u793a",msg:"\u8bf7\u8f93\u5165SQL\u8bed\u53e5\uff01"}):""==databaseName||null==databaseName?$.messager.show({title:"\u63d0\u793a",msg:"\u8bf7\u70b9\u51fb\u5de6\u4fa7\u6307\u5b9a\u6570\u636e\u5e93\uff01"}):(disableOperButton(),$.ajax({type:"post",timeout:2E4,url:baseUrl+"/system/sqlParser/operationSQL",data:{sql:a,databaseConfigId:databaseConfigId},
success:function(a){if("success"==a.status){var b=a.rows;for(a=0;a<b.length;a++){var e=b[a].sqlType,k=b[a].sql;sqlArray.push(k);"select"!=e&&"create"!=e&&"insert"!=e&&c.push(k+"\n")}if(1==isRead&&0<c.length)$.messager.show({title:"\u63d0\u793a",msg:"\u5f53\u524d\u6570\u636e\u5e93\u53ea\u8bfb\uff0c\u4ec5\u5141\u8bb8\u67e5\u8be2.",position:"top",icon:"warning"}),enableOperButton();else if(a=$.cookie("noCaution"),0<c.length&&!a){$("#executeSqlConfirmDialog").dialog("open");b="";for(a=0;a<c.length;a++)b+=
c[a];dangerSQL.setValue(b)}else $.easyui.loading({msg:"\u6267\u884c\u4e2d...",locale:"#sqltextareaDiv"}),window.mainpage.searchTabs.closeAllTabs(),executeSQLArray(sqlArray,index)}else executeMessage.setValue(a.mess),$.messager.show({title:"\u63d0\u793a",msg:a.mess,position:"bottomRight",icon:"warning",timeout:2E3}),enableOperButton()}}))}function setCookieCaution(){$.cookie("noCaution",!0,{expires:7,path:"/"});$("#executeSqlConfirmDialog").dialog("close");enableOperButton()}
function executeSQLOperator(){$("#executeSqlConfirmDialog").dialog("close");$.easyui.loading({msg:"\u6267\u884c\u4e2d...",locale:"#sqltextareaDiv"});window.mainpage.searchTabs.closeAllTabs();executeSQLArray(sqlArray,index)}
function saveSearchDialog(){saveSearch=$("#dlgg").dialog({title:"SQL\u4fdd\u5b58",width:380,height:160,href:baseUrl+"/searchHistory/form",maximizable:!0,modal:!0,buttons:[{text:"\u4fdd\u5b58",iconCls:"icon-ok",handler:function(){saveSearchHistory2()}},{text:"\u53d6\u6d88",iconCls:"icon-cancel",handler:function(){saveSearch.panel("close")}}]})}
function firstLoginConfig(){firstTimeLoginConfigDialog=$("#dlgg").dialog({title:"\u6b22\u8fce!",width:380,height:450,href:baseUrl+"/system/config/configFormFirst",maximizable:!0,modal:!0,buttons:[{text:"\u6d4b\u8bd5",iconCls:"icon-hamburg-networking",handler:function(){testConn()}},{text:"\u4fdd\u5b58",iconCls:"icon-ok",handler:function(){configUpdate3()}},{text:"\u53d6\u6d88",iconCls:"icon-cancel",handler:function(){firstTimeLoginConfigDialog.panel("close")}}]})}
function deleteSearchHistory(a){$.easyui.messager.confirm("\u64cd\u4f5c\u63d0\u9192","\u60a8\u786e\u5b9a\u8981\u5220\u9664\uff1f",function(b){b&&$.ajax({type:"POST",contentType:"application/json;charset=utf-8",url:baseUrl+"/searchHistory/deleteSearchHistory",data:JSON.stringify({id:a}),datatype:"json",success:function(a){searchBG.treegrid("reload");$.messager.show({title:"\u63d0\u793a",msg:a.mess,position:"bottomRight"})}})})}selectSearchHistory2();
function selectSearchHistory2(){searchBG=$("#searchHistoryList").treegrid({method:"POST",url:baseUrl+"/searchHistory/selectSearchHistory",fit:!0,fitColumns:!0,border:!1,idField:"id",treeField:"name",parentField:"pid",iconCls:"icon",animate:!0,rownumbers:!1,singleSelect:!0,striped:!0,columns:[[{field:"sqls",title:"sqls",hidden:!0,width:0},{field:"database",title:"database",hidden:!0,width:0},{field:"name",title:"&nbsp;&nbsp;\u8be6\u60c5",width:210},{field:"_opt",title:"&nbsp;\u64cd\u4f5c",width:30,
formatter:function(a,b,c){return'<a href="javascript:deleteSearchHistory('+b.id+')"><div class="icon-standard-building-delete" style="width:16px;height:16px" title="\u5220\u9664"></div></a>'}}]],enableHeaderClickMenu:!1,enableHeaderContextMenu:!1,enableRowContextMenu:!1,dataPlain:!1,onClickRow:function(a){var b;if((b=parent.$("#mainTabs").tabs("getSelected"))&&0<b.find("iframe").length)if(b=b.find("iframe")[0].contentWindow,"undefined"!=typeof b.newQueryEditor){var c=b.newQueryEditor.getValue();b.newQueryEditor.setValue(a.sqls+
"\n"+c)}else $("#mainTabs").tabs("select",0),b=editor.getValue(),editor.setValue(a.sqls+"\n"+b),$("#searchHistoryId").val(a.id),$("#searchHistoryName").val(a.name);else $("#mainTabs").tabs("select",0),b=editor.getValue(),editor.setValue(a.sqls+"\n"+b),$("#searchHistoryId").val(a.id),$("#searchHistoryName").val(a.name)},onLoadSuccess:function(a){}})}
function ShowPasswordDialog(){pwd=$("#dlgg").dialog({title:"\u4fee\u6539\u5bc6\u7801",width:380,height:200,href:baseUrl+"/system/permission/i/changePass",maximizable:!0,modal:!0,buttons:[{text:"\u4fdd\u5b58",iconCls:"icon-ok",handler:function(){changePass()}},{text:"\u53d6\u6d88",iconCls:"icon-cancel",handler:function(){pwd.panel("close")}}]})}function refresh(){d.datagrid("reload")}
function clearSQL(){$("#sqltextarea").val("");$("#executeMessage").val("");$("#searchHistoryId").val("");$("#searchHistoryName").val("");editor.setValue("");executeMessage.setValue("")}function formatSQL(){var a=$.trim(editor.getValue());editor.setValue(sqlFormatter.format(a))}
function contribute(){$("#addRow").dialog({title:"\u6350\u8d60",width:480,height:500,href:baseUrl+"/system/permission/i/contribute",maximizable:!0,modal:!0,buttons:[{text:"\u5173\u95ed",iconCls:"icon-cancel",handler:function(){$("#addRow").panel("close")}}]})}function persons(){window.mainpage.mainTabs.addModule("\u7528\u6237\u7ba1\u7406",baseUrl+"/system/person/i/person","icon-hamburg-user")}
function help(){$("#addRow").dialog({title:"\u5e2e\u52a9",width:500,height:600,href:baseUrl+"/system/permission/i/help",maximizable:!0,modal:!0,buttons:[{text:"\u5173\u95ed",iconCls:"icon-cancel",handler:function(){$("#addRow").panel("close")}}]})}
function codemirrorAutocompleteOnInputRead(a){sql_autocomplete_in_progress||a.options.hintOptions.tables&&sql_autocomplete||(sql_autocomplete?(a.options.hintOptions.tables=sql_autocomplete,a.options.hintOptions.defaultTable=sql_autocomplete_default_table):(a.options.hintOptions.defaultTable="",sql_autocomplete_in_progress=!0,$.ajax({type:"GET",url:baseUrl+"/system/permission/i/allTableAndColumn/"+currentDbName+"/"+databaseConfigId,success:function(b){sql_autocomplete=[];a.options.hintOptions.tables=
b},complete:function(){sql_autocomplete_in_progress=!1}})));if(!a.state.completionActive){var b=a.getCursor();b=a.getTokenAt(b);var c="";b.string.match(/^[.`\w@]\w*$/)&&(c=b.string);0<c.length&&CodeMirror.commands.autocomplete(a)}}function catchKeypressesFromSqlTextboxes(a){!a.ctrlKey||13!=a.keyCode&&10!=a.keyCode||0<$("#sqltextarea").length||0<$("#sqltextarea").length&&run()}
var executeMessage=CodeMirror.fromTextArea(document.getElementById("executeMessage"),{mode:"text/x-mysql",theme:"eclipse",lineNumbers:!0,autofocus:!1,readOnly:!0});function selectTheme(){var a=$("#codeThemeSelector").val();editor.setOption("theme",a);executeMessage.setOption("theme",a);$.cookie("editStyle",a)}
var executeSQLArray=function(a,b){if(b>=a.length){enableOperButton();$.messager.show({title:"\u63d0\u793a",msg:"\u6267\u884c\u5b8c\u6210\uff01",position:"bottomRight",timeout:2E3});$("#searchTabs").tabs("select",0);executeMessage.setValue(messTemp);var c=$("#searchTabs").tabs("tabs").length;$("#searchTabs").tabs("select",c-1);$.easyui.loaded("#sqltextareaDiv")}else{var e=a[b];";"==e.substr(e.length-1,e.length)&&(e=e.substr(0,e.length-1));executeAjax=$.ajax({type:"post",timeout:2E4,url:baseUrl+"/system/permission/i/executeSqlText/"+
databaseConfigId,data:{sql:e,databaseName:currentDbName},success:function(c){var f=c.status;if(null==c.status)messTemp=messTemp+c+" \n\n";else{if("fail"==f){$.messager.show({title:"\u63d0\u793a",msg:"\u6267\u884c\u5931\u8d25\uff01",position:"bottomRight",timeout:2E3,icon:"warning"});messTemp=messTemp+"\u3010SQL\u3011\n"+e+"\n \u4fe1\u606f\uff1a"+c.mess+" \n\n";$("#searchTabs").tabs("select",0);executeMessage.setValue(messTemp);c=$("#searchTabs").tabs("tabs").length;$("#searchTabs").tabs("select",
c-1);$.easyui.loaded("#sqltextareaDiv");enableOperButton();return}"success"==f?(messTemp=messTemp+"\u3010SQL\u3011\n"+e+"\n \u5f71\u54cd "+c.totalCount+" \u884c\uff0c \n \u6267\u884c\u65f6\u95f4\uff1a"+c.time+"\u6beb\u79d2\u3002\n\n",null!=c.rows&&showResultTabGrid(c,e,b)):messTemp=messTemp+"\u3010SQL\u3011\n"+e+"\n \u4fe1\u606f\uff1a"+c.mess+" \n\n"}executeSQLArray(a,b+1)},error:function(a,b,c){enableOperButton();$.easyui.loaded("#sqltextareaDiv");$.messager.show({title:"\u63d0\u793a",msg:"\u6267\u884c\u5931\u8d25\uff01",
position:"bottomRight",timeout:2E3,icon:"warning"})}})}};
function showResultTabGrid(a,b,c){var e="selectDg"+c,f=' <div id="tb'+c+'" style="padding:5px;height:auto"> <div>  <a href="javascript:void(0)" class="easyui-linkbutton" iconCls="icon-table-row-insert" plain="true" id="addRowButton'+c+'"  onclick="addRow2('+c+')"> \u6dfb\u52a0 </a>  <span class="toolbar-item dialog-tool-separator"></span>  <a href="javascript:void(0)" class="easyui-linkbutton" iconCls="icon-table-row-delete" plain="true" id="delButton'+c+'"   onclick="del( '+c+')">\u5220\u9664</a>  <span class="toolbar-item dialog-tool-separator"></span>  <a href="javascript:void(0)" class="easyui-linkbutton" iconCls="icon-table-edit" plain="true" id="editRowButton'+
c+'" onclick="editRow2('+c+' )">\u4fee\u6539</a>  <span class="toolbar-item dialog-tool-separator"></span>  <a href="javascript:void(0)" class="easyui-linkbutton" iconCls="icon-table-link" plain="true" title="\u5168\u90e8\u5bfc\u51fajson"  id="editRowButton'+c+'" onclick="exportDataToSQLFromSQL('+c+' )">\u5bfc\u51fa</a>  <span class="toolbar-item dialog-tool-separator"></span>  <a href="javascript:void(0)" class="easyui-linkbutton" iconCls="icon-standard-page-excel" plain="true" title="\u5168\u90e8\u5bfc\u51faexcel"  id="editRowButton'+
c+'" onclick="exportDataToExcelFromSQL('+c+' )">\u5bfc\u51fa</a>  <span class="toolbar-item dialog-tool-separator"></span>  <a href="javascript:void(0)" class="easyui-linkbutton" iconCls="icon-table-add"  plain="true" title="\u9009\u62e9\u590d\u5236\u4e3aInsert\u8bed\u53e5"  id="exportInsertSQLButton'+c+'" onclick="chooseSelectDataToSql('+c+',\'insert\' )">\u590d\u5236Insert</a>  <span class="toolbar-item dialog-tool-separator"></span>  <a href="javascript:void(0)" class="easyui-linkbutton" iconCls="icon-table-edit" plain="true" title="\u9009\u62e9\u590d\u5236\u4e3aUpdate\u8bed\u53e5"  id="exportUpdateSQLButton'+
c+'" onclick="chooseSelectDataToSql('+c+',\'update\' )">\u590d\u5236Update</a>  <span class="toolbar-item dialog-tool-separator"></span>  <a href="javascript:void(0)" class="easyui-linkbutton" iconCls="icon-standard-chart-bar" plain="true" title="\u56fe\u8868\u663e\u793a"  id="editRowButton'+c+'" onclick="graphicView('+c+' )">\u56fe\u8868</a>  <span class="toolbar-item dialog-tool-separator"></span>  <a href="javascript:void(0)" class="easyui-linkbutton"  plain="true"  >&nbsp;</a>  <span class="toolbar-item dialog-tool-separator"></span>  <a href="javascript:void(0)" class="easyui-linkbutton" iconCls="icon-ok" plain="true" id="saveRowButton'+
c+'"  onclick="saveRow('+c+' )"> \u4fdd\u5b58 </a>  <span class="toolbar-item dialog-tool-separator"></span>  <a href="javascript:void(0)" class="easyui-linkbutton" iconCls="icon-cancel" plain="true" id="cancelButton'+c+'"  onclick="cancelChange('+c+')"> \u53d6\u6d88 </a>  <span class="toolbar-item dialog-tool-separator"></span>  </div>  </div> ';$("#searchTabs").tabs("add",{title:"\u7ed3\u679c"+(c+1),content:f+" <table id="+e+"></table>",closable:!0,tools:[{iconCls:"icon-berlin-calendar",handler:function(){}}]});
b={url:baseUrl+"/system/permission/i/executeSqlText/"+databaseConfigId,method:"POST",queryParams:{sql:b,databaseName:currentDbName},rownumbers:!0,fit:!0,fitColumns:!0,border:!1,striped:!0,pagination:!0,pageNumber:1,pageSize:30,pageList:[20,30,40,50,100,200],singleSelect:!1,checkOnSelect:!0,toolbar:"#tb"+c,extEditing:!1,autoEditing:!0,singleEditing:!0,selectOnCheck:!0,onBeginEdit:function(a,b){obj=JSON.stringify(b)},onBeforeLoad:function(a){a=$(this).attr("firstLoad");return"false"==a||"undefined"==
typeof a?($(this).attr("firstLoad","true"),!1):!0},onAfterEdit:function(a,b,c){willChangeRow.push({oldData:eval("("+obj+")"),changesData:c})},onSelect:function(a,b){selectRowCount++;1==selectRowCount?$("#editRowButton").linkbutton("enable"):$("#editRowButton").linkbutton("disable")},onUnselect:function(a,b){selectRowCount--;1==selectRowCount?$("#editRowButton").linkbutton("enable"):$("#editRowButton").linkbutton("disable")},onDblClickCell:function(a,b,c){c=$(this).datagrid("getColumnFields",!0).concat($(this).datagrid("getColumnFields"));
for(var e=0;e<c.length;e++){var f=$(this).datagrid("getColumnOption",c[e]);f.editor1=f.editor;c[e]!=b&&(f.editor=null)}$(this).datagrid("beginEdit",a);for(e=0;e<c.length;e++)f=$(this).datagrid("getColumnOption",c[e]),f.editor=f.editor1},onLoadSuccess:function(a){if(0==a.total){a=$(this).data().datagrid.dc.body2;var b=a.width();a.find("table tbody").append("<tr><td width = '"+b+"' style=' height: 25px; text-align: center;' colspan='6'>\u6682\u65e0\u6570\u636e\uff01</td></tr>")}}};b.columns=eval(a.columns);
b.idField=a.primaryKey;b.tableName=a.tableName;e=$("#"+e);0<c&&(b.onDblClickCell=null);e.datagrid(b);e.datagrid("loadData",a.rows);e.datagrid("getPager").pagination("refresh",{total:a.total});b=e.datagrid("getPager").pagination("options").displayMsg;e.datagrid("getPager").pagination("refresh",{displayMsg:'<span class="pagination-btn-separator "></span> &nbsp; <span class="icon-hamburg-full-time">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> &nbsp;\u6267\u884c\u65f6\u95f4\uff1a'+a.time+"\u6beb\u79d2 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; "+
b});if(null==a.operator||"read"==a.operator)$("#addRowButton"+c).linkbutton("disable"),$("#copyRowButton"+c).linkbutton("disable"),$("#delButton"+c).linkbutton("disable"),$("#editRowButton"+c).linkbutton("disable"),$("#saveRowButton"+c).linkbutton("disable"),$("#cancelButton"+c).linkbutton("disable");if(null==databaseType||"MongoDB"==databaseType)$("#exportInsertSQLButton"+c).linkbutton("disable"),$("#exportUpdateSQLButton"+c).linkbutton("disable");0<c&&($("#addRowButton"+c).linkbutton("disable"),
$("#copyRowButton"+c).linkbutton("disable"),$("#delButton"+c).linkbutton("disable"),$("#editRowButton"+c).linkbutton("disable"),$("#saveRowButton"+c).linkbutton("disable"),$("#cancelButton"+c).linkbutton("disable"))}
function exportDataToSQLFromSQL(a){var b=$("#selectDg"+a).datagrid("options").queryParams.sql,c=$("#selectDg"+a).datagrid("options").queryParams.databaseName;$("#sql").val(b);$("#exportType").val("json");$("#databaseName").val(c);$("#databaseConfigId").val(databaseConfigId);a=$("#selectDg"+a).datagrid("getData").total;0<exportLimit&&exportLimit<a?$.messager.show({title:"\u63d0\u793a",msg:"\u5bfc\u51fa\u6570\u636e\u8d85\u51fa\u4e0a\u9650\uff01",position:"bottomRight"}):$("#form3").submit()}
function exportDataToExcelFromSQL(a){var b=$("#selectDg"+a).datagrid("options").queryParams.sql,c=$("#selectDg"+a).datagrid("options").queryParams.databaseName;$("#sql").val(b);$("#exportType").val("excel");$("#databaseName").val(c);$("#databaseConfigId").val(databaseConfigId);a=$("#selectDg"+a).datagrid("getData").total;0<exportLimit&&exportLimit<a?$.messager.show({title:"\u63d0\u793a",msg:"\u5bfc\u51fa\u6570\u636e\u8d85\u51fa\u4e0a\u9650\uff01",position:"bottomRight"}):$("#form3").submit()}
function chooseSelectDataToSql(a,b){var c=$("#selectDg"+a).datagrid("getSelections");if(0==c.length)$.messager.show({title:"\u63d0\u793a",msg:"\u8bf7\u9009\u62e9\u6570\u636e\u884c\uff01",position:"bottomRight"});else{var e="",f=$("#selectDg"+a).datagrid("getColumns");$("#selectDg"+a).datagrid("options");var g=$("#selectDg"+a).datagrid("options").tableName,k=$("#selectDg"+a).datagrid("options").idField;if(null==g||""==g)g=" TABLE_NAME ";if("insert"==b){var h="";e="insert into "+g;$.each(c,function(a,
b){var c="",g="";$.each(f,function(a,e){a=b[e.field];var f=e.field+",";null!=a&&0<(a+"").indexOf("'")&&(a=a.replace("'","\\'"));if(null==a)a="NULL,";else if(""===a)a="'',";else{if("(BLOB)"==a||"(CLOB)"==a)return!0;a="numberbox"==e.editor?a+",":"datetimebox"==e.editor&&"Oracle"==databaseType?"to_date('"+a+"','yyyy-mm-dd hh24:mi:ss'),":"'"+a+"',"}g+=f;c+=a});g=g.substring(0,g.length-1);c=c.substring(0,c.length-1);h=h+e+" ( "+g+" ) values ("+c+");\r\n"});editor.setValue(h+editor.getValue()+"\n");$.messager.show({title:"\u63d0\u793a",
msg:"\u6210\u529f\u590d\u5236"+c.length+"\u884c",position:"bottomRight"})}if("update"==b){h="";var l=[];k&&(l=k.split(","));$.each(c,function(a,b){var c="update "+g+" set ";$.each(f,function(a,e){if(!$.inArray(e.field,l))return!0;a=b[e.field];null!=a&&0<(a+"").indexOf("'")&&(a=a.replace("'","\\'"));if(null==a)a="NULL,";else if(""===a)a="'',";else{if("(BLOB)"==a||"(CLOB)"==a)return!0;a="numberbox"==e.editor?a+",":"datetimebox"==e.editor&&"Oracle"==databaseType?"to_date('"+a+"','yyyy-mm-dd hh24:mi:ss'),":
"'"+a+"',"}c=c+e.field+"="+a});c=c.substring(0,c.length-1);var e="";k?(e=" where 1=1 ",$.each(l,function(a,c){e=b[c]?e+" and "+c+"='"+b[c]+"' ":e+" and "+c+"='' "})):e=" where 1=2 ";h=h+c+e+";\r\n"});editor.setValue(h+editor.getValue()+"\n");$.messager.show({title:"\u63d0\u793a",msg:"\u6210\u529f\u590d\u5236"+c.length+"\u884c",position:"bottomRight"})}}}
function graphicView(a){$("#selectDg"+a).datagrid("options");var b=$("#selectDg"+a).datagrid("options").queryParams.databaseName;window.mainpage.mainTabs.addModule("\u56fe\u8868\u663e\u793a",baseUrl+"/system/graphic/graphicPage/"+b+"/"+databaseConfigId+"/"+a,"icon-standard-chart-bar")}
function addRow2(a){$("#selectDg"+a).datagrid("getChanges","updated").length?$.messager.show({title:"\u63d0\u793a",msg:"\u8bf7\u5148\u4fdd\u5b58\u53d8\u66f4\u5185\u5bb9\uff01",position:"bottomRight"}):($("#selectDg"+a).datagrid("insertRow",{index:0,row:{}}),$("#selectDg"+a).datagrid("beginEdit",0))}
function copyRow(a){a=$("#selectDg"+a).datagrid("getChecked");0==a.length?$.messager.show({title:"\u63d0\u793a",msg:"\u8bf7\u5148\u9009\u62e9\u6570\u636e\uff01",position:"bottomRight"}):$.each(a,function(a,c){$("#selectDg"+a).datagrid("insertRow",{index:0,row:c});$("#selectDg"+a).datagrid("beginEdit",0)})}
function del(a){endEdit(a);var b=$("#selectDg"+a).datagrid("options"),c=b.idField,e=b.tableName;b=$("#selectDg"+a).datagrid("getChanges","inserted");var f=$("#selectDg"+a).datagrid("getChanges","updated");if(b.length||f.length)$.messager.show({title:"\u63d0\u793a",msg:"\u8bf7\u5148\u4fdd\u5b58\u53d8\u66f4\u5185\u5bb9\uff01",position:"bottomRight"});else{var g=$("#selectDg"+a).datagrid("getChecked");b=g.length;0==g.length?$.messager.show({title:"\u63d0\u793a",msg:"\u8bf7\u5148\u9009\u62e9\u4e00\u884c\u6570\u636e\uff01",
position:"bottomRight"}):$.easyui.messager.confirm("\u64cd\u4f5c\u63d0\u9192","\u60a8\u786e\u5b9a\u8981\u5220\u9664"+b+"\u884c\u6570\u636e\uff1f",function(b){b&&$.ajax({type:"POST",contentType:"application/json;charset=utf-8",url:baseUrl+"/system/permission/i/deleteRows/"+databaseConfigId,data:JSON.stringify({databaseName:currentDbName,tableName:e,primary_key:c,checkedItems:JSON.stringify(g)}),datatype:"json",success:function(b){"success"==b.status?($("#selectDg"+a).datagrid("reload"),$("#selectDg"+
a).datagrid("clearSelections").datagrid("clearChecked"),selectRowCount=0,$.messager.show({title:"\u63d0\u793a",msg:"\u5220\u9664\u6210\u529f\uff01",position:"bottomRight"})):$.messager.show({title:"\u63d0\u793a",msg:b.mess,position:"bottomRight",timeout:2E3,icon:"warning"})}})})}}
function saveRow(a){endEdit(a);var b=$("#selectDg"+a).datagrid("getChanges","inserted"),c=willChangeRow,e={},f=$("#selectDg"+a).datagrid("options"),g=f.idField;f=f.tableName;e.databaseName=currentDbName;e.tableName=f;e.primary_key=g;b.length&&(e.inserted=JSON.stringify(b));c.length&&(e.updated=JSON.stringify(c));(b.length||c.length)&&$.post(baseUrl+"/system/permission/i/saveData/"+databaseConfigId,e,function(b){willChangeRow=[];"success"==b.status?($.messager.show({title:"\u63d0\u793a",msg:"\u4fdd\u5b58\u6210\u529f\uff01",
position:"bottomRight"}),$("#selectDg"+a).datagrid("acceptChanges")):$.messager.alert("\u63d0\u793a",b.mess)},"JSON").error(function(){$.messager.alert("\u63d0\u793a","\u63d0\u4ea4\u9519\u8bef\u4e86\uff01")})}function refresh(a){$("#selectDg"+a).datagrid("reload");$("#selectDg"+a).datagrid("clearSelections").datagrid("clearChecked")}function endEdit(a){for(var b=$("#selectDg"+a).datagrid("getRows"),c=0;c<b.length;c++)$("#selectDg"+a).datagrid("endEdit",c)}
function editRow2(a){var b=$("#selectDg"+a).datagrid("getChecked");0==b.length?$.messager.show({title:"\u63d0\u793a",msg:"\u8bf7\u5148\u9009\u62e9\u4e00\u884c\u6570\u636e\uff01",position:"bottomRight"}):$.each(b,function(b,e){b=$("#selectDg"+a).datagrid("getRowIndex",e);$("#selectDg"+a).datagrid("beginEdit",b)})}function cancelChange(a){endEdit(a);refresh(a)}function refresh(a){$("#selectDg"+a).datagrid("reload");$("#selectDg"+a).datagrid("clearSelections").datagrid("clearChecked")}
function searchVersion(){$.ajax({type:"GET",timeout:1E3,url:"http://www.treesoft.cn/treesoft/system/searchVersion",datatype:"json",success:function(a){},error:function(a){}})}function dataStatistics(){window.mainpage.mainTabs.addModule("\u6570\u636e\u91cf\u7edf\u8ba1&nbsp;"+databaseName,baseUrl+"/system/permission/i/dataStatistics/"+databaseName+"/"+databaseConfigId,"icon-standard-chart-bar-edit")}
function clickNoSQLDbName(a){window.mainpage.mainTabs.addModule(a,baseUrl+"/redis/showNoSQLDBData/"+a+"/"+databaseConfigId,"icon-berlin-project")}
$("#mainTabs").tabs({onSelect:function(a,b){a=$("#mainTabs").tabs("getSelected");0==b&&editor&&(editor.focus(),0==$("#mainLayout").layout("panel","west")[0].clientWidth&&$("#mainLayout").layout("expand","west"));a&&0<a.find("iframe").length&&(b=a.find("iframe")[0].contentWindow,"undefined"!=typeof b.newQueryEditor&&(a=b.$("#newQuerySearchTabs").tabs("getSelected"),a=b.$("#newQuerySearchTabs").tabs("getTabIndex",a),b.$("#newQuerySearchTabs").tabs("select",a),b.newQueryEditor.focus()))}});
function stopRun(){enableOperButton();executeAjax.abort();$.easyui.loaded("#sqltextareaDiv")}function disableOperButton(){$("#runButton").linkbutton("disable");$("#stopRunButton").linkbutton("enable");$("#clearSQLButton").linkbutton("disable");$("#formatSQLButton").linkbutton("disable");$("#explainSQLButton").linkbutton("disable");$("#newQueryButton").linkbutton("disable");$("#saveSearchButton").linkbutton("disable");$("#codeThemeSelector").attr("disabled",!0)}
function enableOperButton(){$("#runButton").linkbutton("enable");$("#stopRunButton").linkbutton("disable");$("#clearSQLButton").linkbutton("enable");$("#formatSQLButton").linkbutton("enable");$("#explainSQLButton").linkbutton("enable");$("#newQueryButton").linkbutton("enable");$("#saveSearchButton").linkbutton("enable");$("#codeThemeSelector").attr("disabled",!1)}$("#mainTabs_monitorGlobal").click(function(){openMonitorGlobalPage()});
function openMonitorGlobalPage(){window.mainpage.mainTabs.addModule("\u6570\u636e\u5e93\u603b\u89c8",baseUrl+"/monitorGlobal/monitorGlobalPage","icon-hamburg-monitor")}function openFirstTab(){$("#mainTabs").tabs("select",0)};

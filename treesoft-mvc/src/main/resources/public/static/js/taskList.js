var dgg,task,taskLog;$(function(){initData()});
function initData(){dgg=$("#dg3").datagrid({method:"post",url:baseUrl+"/system/task/i/taskList?v="+Math.random(),fit:!0,fitColumns:!0,border:!1,idField:"id",striped:!0,pagination:!0,rownumbers:!0,pageNumber:1,pageSize:20,pageList:[10,20,30,40,50],singleSelect:!1,columns:[[{field:"TREESOFTPRIMARYKEY",checkbox:!0},{field:"id",title:"\u64cd\u4f5c",width:80,align:"center",halign:"center",sortable:!0,formatter:function(a,b,c){return'<a  class="l-btn l-btn-small" href="javascript:viewLog(\''+b.id+'\')" ><span class="l-btn-left l-btn-icon-left"><span class="l-btn-text" style="line-height: 18px;">\u65e5\u5fd7</span><span class="l-btn-icon icon-search">&nbsp;</span></span></a> <a class="l-btn l-btn-small" href="javascript:editTaskFormOne(\''+
b.id+'\')" ><span class="l-btn-left l-btn-icon-left"><span class="l-btn-text" style="line-height: 18px;">\u4fee\u6539</span><span class="l-btn-icon icon-edit">&nbsp;</span></span></a> '}},{field:"name",title:"\u4efb\u52a1\u540d\u79f0",halign:"center",width:100},{field:"sourceConfig",title:"\u6570\u636e\u5e93\u914d\u7f6e",halign:"center",sortable:!0,width:100},{field:"sourceDataBase",title:"\u6570\u636e\u5e93\u540d",halign:"center",sortable:!0,width:100},{field:"state",title:"\u662f\u5426\u542f\u7528",
halign:"center",sortable:!0,formatter:function(a,b,c){return"0"==b.state?'<font color="green">\u542f\u7528</font>':"1"==b.state?'<font color="red">\u505c\u7528</font>':""}},{field:"status",title:"\u5f53\u524d\u8fd0\u884c\u72b6\u6001",halign:"center",sortable:!0,formatter:function(a,b,c){return"0"==b.status?'<font color="red">\u505c\u6b62</font>':"1"==b.status?'<font color="green">\u8fd0\u884c\u4e2d</font>':"2"==b.status?'<font color="green">\u6210\u529f</font>':"3"==b.status?'<font color="red">\u5f02\u5e38</font>':
""}}]],checkOnSelect:!0,selectOnCheck:!0,extEditing:!1,toolbar:"#tb3",autoEditing:!1,singleEditing:!1,onDblClickRow:function(a,b){a=b.id;task=$("#dlgg").dialog({title:"\u67e5\u770b",width:580,height:400,href:baseUrl+"/system/task/i/editTaskForm/"+a,maximizable:!0,modal:!0,buttons:[{text:"\u53d6\u6d88",iconCls:"icon-cancel",handler:function(){task.panel("close")}}]})}})}
function addConfigForm(){task=$("#dlgg").dialog({title:" \u65b0\u589e",width:580,height:400,href:baseUrl+"/system/task/i/addTaskForm",maximizable:!0,modal:!0,buttons:[{text:"\u4fdd\u5b58",iconCls:"icon-ok",handler:function(){$("#mainform").submit()}},{text:"\u53d6\u6d88",iconCls:"icon-cancel",handler:function(){task.panel("close")}}]})}
function editConfigForm(){var a=$("#dg3").datagrid("getChecked");0==a.length?parent.$.messager.show({title:"\u63d0\u793a",msg:"\u8bf7\u5148\u9009\u62e9\u4e00\u884c\u6570\u636e\uff01",position:"bottomRight"}):1<a.length?parent.$.messager.show({title:"\u63d0\u793a",msg:"\u8bf7\u9009\u62e9\u4e00\u884c\u6570\u636e\uff01",position:"bottomRight"}):(a=a[0].id,task=$("#dlgg").dialog({title:"\u4fee\u6539",width:580,height:400,href:baseUrl+"/system/task/i/editTaskForm/"+a,maximizable:!0,modal:!0,buttons:[{text:"\u4fdd\u5b58",
iconCls:"icon-ok",handler:function(){$("#mainform").submit()}},{text:"\u53d6\u6d88",iconCls:"icon-cancel",handler:function(){task.panel("close")}}]}))}function editTaskFormOne(a){task=$("#dlgg").dialog({title:"\u4fee\u6539",width:580,height:400,href:baseUrl+"/system/task/i/editTaskForm/"+a,maximizable:!0,modal:!0,buttons:[{text:"\u4fdd\u5b58",iconCls:"icon-ok",handler:function(){$("#mainform").submit()}},{text:"\u53d6\u6d88",iconCls:"icon-cancel",handler:function(){task.panel("close")}}]})}
function deleteConfig(){var a=$("#dg3").datagrid("getChecked"),b=a.length;if(0>=$("#dg3").datagrid("getData").total-b)parent.$.messager.show({title:"\u63d0\u793a",msg:"\u5fc5\u987b\u4fdd\u7559\u4e00\u884c\u914d\u7f6e\u4fe1\u606f\uff01",position:"bottomRight"});else if(0==a.length)parent.$.messager.show({title:"\u63d0\u793a",msg:"\u8bf7\u5148\u9009\u62e9\u4e00\u884c\u6570\u636e\uff01",position:"bottomRight"});else{var c=[];$.each(a,function(a,b){c.push(b.id)});$.easyui.messager.confirm("\u64cd\u4f5c\u63d0\u793a",
"\u60a8\u786e\u5b9a\u8981\u5220\u9664"+b+"\u884c\u6570\u636e\u5417\uff1f",function(a){a&&$.ajax({type:"POST",contentType:"application/json;charset=utf-8",url:baseUrl+"/system/task/i/deleteTask",data:JSON.stringify({ids:c}),datatype:"json",success:function(a){"success"==a.status?($("#dg3").datagrid("reload"),$("#dg3").datagrid("clearSelections").datagrid("clearChecked"),parent.$.messager.show({title:"\u63d0\u793a",msg:"\u5220\u9664\u6210\u529f\uff01",position:"bottomRight"})):parent.$.messager.show({title:"\u63d0\u793a",
msg:a.mess,position:"bottomRight"})}})})}}
function startTask(){var a=$("#dg3").datagrid("getChecked");$("#dg3").datagrid("getData");if(0==a.length)parent.$.messager.show({title:"\u63d0\u793a",msg:"\u8bf7\u9009\u62e9\u4e00\u884c\u6570\u636e\uff01",position:"bottomRight"});else{var b=[];$.each(a,function(a,d){b.push(d.id)});$.ajax({type:"POST",contentType:"application/json;charset=utf-8",url:baseUrl+"/system/task/i/startTask",data:JSON.stringify({ids:b}),datatype:"json",success:function(a){"success"==a.status&&($("#dg3").datagrid("reload"),
$("#dg3").datagrid("clearSelections").datagrid("clearChecked"));parent.$.messager.show({title:"\u63d0\u793a",msg:a.mess,position:"bottomRight"})}})}}
function startTaskOne(){var a=$("#dg3").datagrid("getChecked");$("#dg3").datagrid("getData");if(0==a.length)parent.$.messager.show({title:"\u63d0\u793a",msg:"\u8bf7\u9009\u62e9\u4e00\u884c\u6570\u636e\uff01",position:"bottomRight"});else{var b=!1,c=[];$.each(a,function(a,e){c.push(e.id);if("1"==e.status)return parent.$.messager.show({title:"\u63d0\u793a",msg:"\u8fd0\u884c\u4e2d\u7684\u4efb\u52a1\u65e0\u6cd5\u6267\u884c\u8be5\u64cd\u4f5c\uff01",position:"bottomRight"}),b=!0,!1});b||(c=[],$.each(a,
function(a,b){c.push(b.id)}),$.ajax({type:"POST",contentType:"application/json;charset=utf-8",url:baseUrl+"/system/task/i/startTaskOne",data:JSON.stringify({ids:c}),datatype:"json",success:function(a){"success"==a.status&&($("#dg3").datagrid("reload"),$("#dg3").datagrid("clearSelections").datagrid("clearChecked"));parent.$.messager.show({title:"\u63d0\u793a",msg:a.mess,position:"bottomRight"})}}))}}
function stopTask(){var a=$("#dg3").datagrid("getChecked");$("#dg3").datagrid("getData");if(0==a.length)parent.$.messager.show({title:"\u63d0\u793a",msg:"\u8bf7\u9009\u62e9\u4e00\u884c\u6570\u636e\uff01",position:"bottomRight"});else{var b=[];$.each(a,function(a,d){b.push(d.id)});$.ajax({type:"POST",contentType:"application/json;charset=utf-8",url:baseUrl+"/system/task/i/stopTask",data:JSON.stringify({ids:b}),datatype:"json",success:function(a){"success"==a.status&&($("#dg3").datagrid("reload"),$("#dg3").datagrid("clearSelections").datagrid("clearChecked"));
parent.$.messager.show({title:"\u63d0\u793a",msg:a.mess,position:"bottomRight"})}})}}function refresh12(){$("#dg3").datagrid("reload");$("#dg3").datagrid("clearSelections").datagrid("clearChecked")}function viewLog(a){taskLog=$("#dlgg2").dialog({title:"\u65e5\u5fd7\u67e5\u770b",width:680,height:480,href:baseUrl+"/system/task/i/taskLogForm/"+a,maximizable:!0,modal:!0,buttons:[{text:"\u53d6\u6d88",iconCls:"icon-cancel",handler:function(){taskLog.panel("close")}}]})}
function copyTask(){var a=$("#dg3").datagrid("getChecked");$("#dg3").datagrid("getData");if(0==a.length)parent.$.messager.show({title:"\u63d0\u793a",msg:"\u8bf7\u5148\u9009\u62e9\u4e00\u884c\u6570\u636e\uff01",position:"bottomRight"});else{var b=[];$.each(a,function(a,d){b.push(d.id)});$.ajax({type:"POST",contentType:"application/json;charset=utf-8",url:baseUrl+"/system/task/i/copyDataTask",data:JSON.stringify({ids:b}),datatype:"json",success:function(a){"success"==a.status&&($("#dg3").datagrid("reload"),
$("#dg3").datagrid("clearSelections").datagrid("clearChecked"));parent.$.messager.show({title:"\u63d0\u793a",msg:a.mess,position:"bottomRight"})}})}}
function monitorConfigForm(){monitorConfig=$("#dlgg").dialog({title:"&nbsp;\u9884\u8b66\u914d\u7f6e",width:400,height:370,href:baseUrl+"/monitorConfig/monitorConfigTaskForm?id=2222abc",maximizable:!0,modal:!0,buttons:[{text:"\u4fdd\u5b58",iconCls:"icon-ok",handler:function(){$("#monitorConfigForm").submit()}},{text:"\u53d6\u6d88",iconCls:"icon-cancel",handler:function(){monitorConfig.panel("close")}}]})};

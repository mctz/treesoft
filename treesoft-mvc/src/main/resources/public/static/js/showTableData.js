var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){a!=Array.prototype&&a!=Object.prototype&&(a[b]=c.value)};$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX="jscomp_symbol_";
$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.Symbol=function(){var a=0;return function(b){return $jscomp.SYMBOL_PREFIX+(b||"")+a++}}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.iterator;a||(a=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[a]&&$jscomp.defineProperty(Array.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};$jscomp.arrayIterator=function(a){var b=0;return $jscomp.iteratorPrototype(function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}})};
$jscomp.iteratorPrototype=function(a){$jscomp.initSymbolIterator();a={next:a};a[$jscomp.global.Symbol.iterator]=function(){return this};return a};$jscomp.iteratorFromArray=function(a,b){$jscomp.initSymbolIterator();a instanceof String&&(a+="");var c=0,e={next:function(){if(c<a.length){var f=c++;return{value:b(f,a[f]),done:!1}}e.next=function(){return{done:!0,value:void 0}};return e.next()}};e[Symbol.iterator]=function(){return e};return e};
$jscomp.polyfill=function(a,b,c,e){if(b){c=$jscomp.global;a=a.split(".");for(e=0;e<a.length-1;e++){var f=a[e];f in c||(c[f]={});c=c[f]}a=a[a.length-1];e=c[a];b=b(e);b!=e&&null!=b&&$jscomp.defineProperty(c,a,{configurable:!0,writable:!0,value:b})}};$jscomp.polyfill("Array.prototype.keys",function(a){return a?a:function(){return $jscomp.iteratorFromArray(this,function(a){return a})}},"es6","es3");
var dg,d,dlgg,primary_key,selectRowCount=0,columnsTemp=[],databaseName,tableName,add,obj,isCopy=!1,isAdd=!1,isSuccessSave=!0,updatedRowIndex,willChangeRow=[],databaseConfigId;
$(function(){databaseConfigId=$("#databaseConfigId").val();databaseName=$("#databaseName").val();tableName=$("#tableName").val();query();"view"==$("#objectType").val()&&($("#addRowButton").linkbutton("disable"),$("#copyRowButton").linkbutton("disable"),$("#delButton").linkbutton("disable"),$("#editTableButton").linkbutton("disable"),$("#saveRowButton").linkbutton("disable"),$("#cancelButton").linkbutton("disable"),$("#importDataButton").linkbutton("disable"),$("#exportDataToSQLButton").linkbutton("disable"),
$("#operatorHint").hide())});function query(){var a=baseUrl+"/system/permission/i/table/"+tableName+"/"+databaseName+"/"+databaseConfigId;$.easyui.loading({msg:"\u6267\u884c\u4e2d\uff0c\u8bf7\u7a0d\u7b49\uff01"});$.post(a,null,showGrid,"json")}
function showGrid(a){var b={url:baseUrl+"/system/permission/i/table/"+tableName+"/"+databaseName+"/"+databaseConfigId,rownumbers:!0,fit:!0,fitColumns:!0,border:!1,striped:!0,pagination:!0,pageNumber:1,pageSize:30,pageList:[10,20,30,40,500],singleSelect:!1,checkOnSelect:!0,selectOnCheck:!0,extEditing:!1,toolbar:"#tb2",autoEditing:!1,singleEditing:!1,onBeginEdit:function(a,b){obj=JSON.stringify(b);updatedRowIndex=a},onBeforeLoad:function(a){a=$(this).attr("firstLoad");return"false"==a||"undefined"==
typeof a?($(this).attr("firstLoad","true"),!1):!0},onAfterEdit:function(a,b,f){0<Object.keys(f).length&&willChangeRow.push({oldData:eval("("+JSON.stringify(b)+")"),changesData:f})},onSelect:function(a,b){selectRowCount++;1==selectRowCount?$("#editRowButton").linkbutton("enable"):$("#editRowButton").linkbutton("disable")},onUnselect:function(a,b){selectRowCount--;1==selectRowCount?$("#editRowButton").linkbutton("enable"):$("#editRowButton").linkbutton("disable")},onDblClickCell:function(a,b,f){-1<
primary_key.split(",").indexOf(b)&&(e.editor=null);f=$(this).datagrid("getColumnFields",!0).concat($(this).datagrid("getColumnFields"));for(var c=0;c<f.length;c++){var e=$(this).datagrid("getColumnOption",f[c]);e.editor1=e.editor;f[c]!=b&&(e.editor=null)}$(this).datagrid("beginEdit",a);for(c=0;c<f.length;c++)e=$(this).datagrid("getColumnOption",f[c]),e.editor=e.editor1}};"fail"==a.status&&$.messager.show({title:"\u63d0\u793a",msg:a.mess,position:"center"});b.columns=eval(a.columns);primary_key=b.idField=
a.primaryKey;dg=$("#dg2");dg.datagrid(b);dg.datagrid("loadData",a.rows);dg.datagrid("getPager").pagination("refresh",{total:a.total});"read"==a.operator&&($("#addRowButton").linkbutton("disable"),$("#copyRowButton").linkbutton("disable"),$("#delButton").linkbutton("disable"),$("#editTableButton").linkbutton("disable"),$("#saveRowButton").linkbutton("disable"),$("#cancelButton").linkbutton("disable"),$("#importDataButton").linkbutton("disable"),$("#operatorHint").hide());$.easyui.loaded()}
function del(){var a=$("#dg2").datagrid("options").idField,b=$("#dg2").datagrid("getChanges","inserted"),c=$("#dg2").datagrid("getChanges","updated");if(b.length||c.length)$.messager.show({title:"\u63d0\u793a",msg:"\u8bf7\u5148\u4fdd\u5b58\u53d8\u66f4\u5185\u5bb9\uff01",position:"bottomRight"});else{var e=$("#dg2").datagrid("getChecked");b=e.length;0==e.length?$.messager.show({title:"\u63d0\u793a",msg:"\u8bf7\u5148\u9009\u62e9\u4e00\u884c\u6570\u636e\uff01",position:"bottomRight"}):$.easyui.messager.confirm("\u64cd\u4f5c\u63d0\u9192",
"\u60a8\u786e\u5b9a\u8981\u5220\u9664"+b+"\u884c\u6570\u636e\uff1f",function(b){b&&$.ajax({type:"POST",contentType:"application/json;charset=utf-8",url:baseUrl+"/system/permission/i/deleteRows/"+databaseConfigId,data:JSON.stringify({databaseName:databaseName,tableName:tableName,primary_key:a,checkedItems:JSON.stringify(e)}),datatype:"json",success:function(a){"success"==a.status?($("#dg2").datagrid("reload"),$("#dg2").datagrid("clearSelections").datagrid("clearChecked"),selectRowCount=0,$.messager.show({title:"\u63d0\u793a",
msg:"\u5220\u9664\u6210\u529f\uff01",position:"bottomRight"})):$.messager.show({title:"\u63d0\u793a",msg:a.mess,position:"bottomRight"})}})})}}function refresh(){isAdd=isCopy=!1;$("#dg2").datagrid("reload");$("#dg2").datagrid("clearSelections").datagrid("clearChecked")}function designTable(){parent.window.mainpage.mainTabs.addModule("\u8bbe\u8ba1"+tableName+" @"+databaseName,baseUrl+"/system/permission/i/designTable/"+tableName+"/"+databaseName+"/"+databaseConfigId,"icon-hamburg-config")}
function exportDataToSQL(){var a=$("#dg2").datagrid("getChecked");0==a.length?$.messager.show({title:"\u63d0\u793a",msg:"\u8bf7\u5148\u9009\u62e9\u4e00\u884c\u6570\u636e\uff01",position:"center"}):($("#checkedItems").val(JSON.stringify(a)),$("#primary_key").val(primary_key),$("#form2").submit())}
function saveRow(){endEditAll();var a=$("#dg2").datagrid("getChanges","inserted"),b=willChangeRow,c={};c.databaseName=databaseName;c.tableName=tableName;c.primary_key=primary_key;a.length&&(c.inserted=JSON.stringify(a));isCopy||isAdd||!b.length||(c.updated=JSON.stringify(b));(a.length||b.length)&&$.post(baseUrl+"/system/permission/i/saveData/"+databaseConfigId,c,function(a){willChangeRow=[];"success"==a.status?($.messager.show({title:"\u63d0\u793a",msg:"\u4fdd\u5b58\u6210\u529f\uff01",position:"bottomRight"}),
isAdd&&$("#dg2").datagrid("acceptChanges"),isCopy=isAdd=!1):($.messager.alert("\u63d0\u793a",a.mess),$("#dg2").datagrid("beginEdit",updatedRowIndex))},"JSON").error(function(){$.messager.alert("\u63d0\u793a","\u63d0\u4ea4\u9519\u8bef\u4e86\uff01")})}function addRow2(){isAdd=!0;$("#dg2").datagrid("insertRow",{index:0,row:{}});$("#dg2").datagrid("beginEdit",0)}
function copyRow(){isCopy=!0;var a=$("#dg2").datagrid("getChecked");0==a.length?parent.$.messager.show({title:"\u63d0\u793a",msg:"\u8bf7\u5148\u9009\u62e9\u6570\u636e\uff01",position:"bottomRight"}):$.each(a,function(a,c){$("#dg2").datagrid("insertRow",{index:0,row:c});$("#dg2").datagrid("beginEdit",0)})}
function editRow2(){var a=$("#dg2").datagrid("getChecked");0==a.length?parent.$.messager.show({title:"\u63d0\u793a",msg:"\u8bf7\u5148\u9009\u62e9\u4e00\u884c\u6570\u636e\uff01",position:"bottomRight"}):$.each(a,function(a,c){a=$("#dg2").datagrid("getRowIndex",c);$("#dg2").datagrid("beginEdit",a)})}function cancelChange(){endEditAll();refresh()}function endEditAll(){for(var a=$("#dg2").datagrid("getRows"),b=0;b<a.length;b++)$("#dg2").datagrid("endEdit",b)}
function endEditByIndex(a){$("#dg2").datagrid("endEdit",a)}function importFile(){dlgg=$("#dlgg").dialog({title:" \u5bfc\u5165\u6570\u636e",width:385,height:490,href:baseUrl+"/system/permission/importFileForm/"+tableName+"/"+databaseName+"/"+databaseConfigId,maximizable:!1,minimizable:!1,modal:!0,buttons:[{text:"\u63d0\u4ea4",iconCls:"icon-ok",handler:function(){uploadFile()}},{text:"\u53d6\u6d88",iconCls:"icon-cancel",handler:function(){dlgg.panel("close")}}]})}
function fileSelected(){var a=document.getElementById("fileToUpload").files[0].name;a=a.substring(a.lastIndexOf(".")+1,a.length);$("#progressNumber").progressbar("setValue",0);"txt"==a.toLowerCase()?($(":radio[name='fileType'][value='txt']").prop("checked","checked"),$("#demarcate").val("")):"csv"==a.toLowerCase()?($(":radio[name='fileType'][value='csv']").prop("checked","checked"),$("#demarcate").val('"')):"xls"==a.toLowerCase()?($("#spaceTypeDiv").hide(),$(":radio[name='fileType'][value='xls']").prop("checked",
"checked")):"sql"==a.toLowerCase()?($("#spaceTypeDiv").hide(),$(":radio[name='fileType'][value='sql']").prop("checked","checked")):"xlsx"==a.toLowerCase()?parent.$.messager.show({title:"\u63d0\u793a",msg:"\u60a8\u597d\uff0c\u76ee\u524d\u4ec5\u652f\u6301office 2003\u7248\u672c\uff0c\u8bf7\u5c06\u6587\u4ef6\u8f6c\u4e3axls\u683c\u5f0f\uff01",position:"center"}):parent.$.messager.show({title:"\u63d0\u793a",msg:"\u60a8\u597d\uff0c\u76ee\u524d\u4e0d\u652f\u6301 "+a+" \u683c\u5f0f\uff01",position:"center"})}
function uploadFile(){var a=document.getElementById("fileToUpload").files[0],b=a.name;b=b.substring(b.lastIndexOf(".")+1,b.length);null==a?parent.$.messager.show({title:"\u63d0\u793a",msg:"\u8bf7\u5148\u9009\u62e9\u4e00\u4e2a\u6587\u4ef6\uff01",position:"center"}):"xlsx"==b.toLowerCase()?parent.$.messager.show({title:"\u63d0\u793a",msg:"\u60a8\u597d\uff0c\u76ee\u524d\u4ec5\u652f\u6301office 2003\u7248\u672c\uff0c\u8bf7\u5c06\u6587\u4ef6\u8f6c\u4e3axls\u683c\u5f0f\uff01",position:"center"}):(a=new FormData,
a.append("fileToUpload",document.getElementById("fileToUpload").files[0]),a.append("fileType",$("#fileType:checked").val()),a.append("spaceType",$("#spaceType").val()),a.append("demarcate",$("#demarcate").val()),$("#haveTitle").is(":checked")?a.append("haveTitle","true"):a.append("haveTitle","false"),a.append("importType",$("#importType:checked").val()),a.append("updateRule",$("#updateRule:checked").val()),a.append("characters",$("#encoding").val()),a.append("tableName",tableName),a.append("databaseName",
databaseName),a.append("databaseConfigId",databaseConfigId),b=new XMLHttpRequest,b.upload.addEventListener("progress",uploadProgress,!1),b.addEventListener("load",uploadComplete,!1),b.addEventListener("error",uploadFailed,!1),b.addEventListener("abort",uploadCanceled,!1),b.open("POST",baseUrl+"/system/importFile/fileUpload"),b.send(a))}
function uploadProgress(a){a.lengthComputable?(a=Math.round(100*a.loaded/a.total),$("#progressNumber").progressbar("setValue",a)):document.getElementById("progressNumber").innerHTML="\u65e0\u6cd5\u8ba1\u7b97"}
function uploadComplete(a){a=eval("("+a.target.responseText+")");$("#dg2").datagrid("reload");$("#dg2").datagrid("clearSelections").datagrid("clearChecked");"success"==a.status?parent.$.messager.show({title:"\u63d0\u793a",msg:a.mess,position:"bottomRight"}):parent.$.messager.show({title:"\u63d0\u793a",msg:a.mess,position:"center"})}function uploadFailed(a){alert("\u4e0a\u4f20\u51fa\u9519.")}
function uploadCanceled(a){alert("\u4e0a\u4f20\u5df2\u7531\u7528\u6237\u6216\u6d4f\u89c8\u5668\u53d6\u6d88\u5220\u9664\u8fde\u63a5.")};
